var mboxRequestParameters={};var s_segList="";var mboxFactoryDefault={getUrlBuilder:function(){return{addParameter:function(a,b){addParameterToGlobalMboxRequest(a,b)}}}};function aam_tnt_cb(){var c=arguments[0].stuff;if(c!==undefined&&c!==""&&c[0].cv!==""){for(var b=0;b<c.length;b++){if(c[b].cn==="aam_tnt"){var a=c[b].cv.split(",");if(s_segList.length>0){s_segList+=","}s_segList+=a;a.forEach(validateAndAddArrayParameter)}}}}function addParameterToGlobalMboxRequest(a,b){mboxRequestParameters[a]=b}function validateAndAddArrayParameter(a){var b=a.split("=");if(b.length>1){addParameterToGlobalMboxRequest(b[0],b[1])}}(function(){var am=[],H=[],m=[],l=[],g=[],h={},i={},j=4000,p=1000,k="",f="",q="",o="",C=false,T="",aj,W,a,P={},b="https://cba.demdex.net/event?d_stuff=1&d_dst=1&d_rtbd=json&d_cts=1&d_cb=aam_tnt_cb&d_dpid=604&d_dpuuid=";window.tntSelectedVariant="_default";window.tntSelectedSecondaryVariant="_default";function O(ap,ao){H[ap]=true;clearTimeout(am[ap]);$(document).trigger("mbox_success",ap)}function n(ar,av,aq,at){var ao=Q.defer(),az=window.tntSelectedVariant,aw=window.tntSelectedSecondaryVariant,ap,au;if(av.indexOf("tntCallback")>-1){var aA=av.substring(av.indexOf("tntCallback")).split("'");if(aA.length>1){az=aA[1]}}if(av.indexOf("tntSecondaryCallback")>-1){var ax=av.substring(av.indexOf("tntSecondaryCallback")).split("'");if(ax.length>1){aw=ax[1]}}var ay=at&&at.attr("id")?at.attr("id"):undefined;if(ay&&ay.indexOf("Second")>-1){al(aw)}else{if(az){ak(az)}}if($.cbaMbox.isRenderHtmlUsingTntUrl&&av.indexOf("tntCallback")<0&&av.indexOf("tntSecondaryCallback")<0){U(av).then(function(aB){if(at){au=at.data("parameter").Campaign?at.data("parameter").Campaign:""}else{au=ar?ar.getName():""}if(au!==""&&i[au]){aB=V(aB,i[au])}ap=G(ar,av,aB,at);ao.resolve(ap)})}else{ap=G(ar,av,aq,at);ao.resolve(ap)}return ao.promise}function G(aq,ax,ap,at){var ar,au,aw="";if(at){ar=at;au=ar.data("parameter").Campaign;aw=ar.data("parameter").TrackParams}else{ar=aq.Ub?$(aq.Ub):((aq.Cb&&aq.Cb.Tb)?$("#"+aq.Cb.Tb):undefined);au=aq.getName()}var av=(ar&&ar.length>0)?ar.data("parameter"):undefined,az=m[au],ao=$("<div></div>"),ay=/<(img|link|script)[^>]*(?:href|src)="(\/.*?)"\s*>\s*(?:<\s*\/script>)*/g;ao.html('<div id="mboxClick-'+au+'"></div>');ap=ap.replace(ay,function(aA,aB,aC){if(aB==="script"){E(az+aC);return""}else{return aA.replace(aC,az+aC)}});if((ap.replace(/<!--[\s\S]*?-->/g,"").replace(/<div[\s\S]*?>/g,"").length<=20&&ax.indexOf("tntCallback")<0)||ap.indexOf("<title>")>0){if(av&&av.Campaign){N(av.Campaign,ar[0]);an(ax,au,true,aw);return ao[0]}}else{if(H[au]){return ao[0]}else{if(av){if(av.CQDriven&&av.DefaultContentControlClientId){$("#"+av.DefaultContentControlClientId).hide()}}if(location.pathname.indexOf("dynamiclandingpage")>=0){ap=ap.replace(/<script[^>]*>(?:(?!<\/script>)[^])*<\/script>/g,"")}ao.html(ap);ao.find("a").each(function(){var aB=$(this),aF=false,aC=aB.attr("href"),aE=aB.attr("data-proposition-code"),aA=aB.attr("data-action-code")?aB.attr("data-action-code"):aB.attr("data-tracker-locationid")?aB.attr("data-tracker-locationid"):"1";if(aC&&aC!=="#"&&aC.indexOf("#")!==0){if(/^https:\/\/www\.commbank\.com\.au\/(digital|retail)\//.test(aC)||/^https:\/\/www\d?\.my\.commbank\.com\.au\//.test(aC)){}else{if(/^\w*:\/\//.test(aC)){aB.attr("target","_blank");aF=true}else{if((aC.startsWith("/digital/")||aC.startsWith("/retail/"))&&o){aC=o+aC;aB.attr("href",aC)}else{if(q){aC=q+"/netbank"+(aC.startsWith("/")?"":"/")+aC;aB.attr("href",aC)}}}}}if(!ar&&typeof h[au]!=="undefined"){ar=h[au]}var aD=ar.data("parameter").FeedbackParams;if(f.length>0&&aC!==undefined&&(aC==="#"||aC.indexOf("#")!==0)&&aD){if(aF){aB.click(function(aG){$.cbaMbox.ceeCallOnBanner(aF,null,aD,aA,au)})}else{aB.attr("href","javascript:void(0)").click(function(aG){aG.preventDefault();$.cbaMbox.ceeCallOnBanner(aF,aC,aD,aA,au)})}}});an(ax,au,false,aw)}}return ao[0]}function an(aw,ap,ao,at){var ax=aw.substr(aw.indexOf("tntVal = ")+10,20),aq=document.getElementById("SC_WEBTRACKER_ID"),ar;ax=ax.substr(0,ax.indexOf("'"));window.s_tnt=window.s_tnt||"";if(window.s_tnt.indexOf(ax)===-1){window.s_tnt+=ax}var au="cba-netbank-dev",av=window.location.host;if(/www\d?\.my\.commbank\.com\.au/i.test(av)||/www\d?\.commbank\.com\.au/i.test(av)){au="cba-prod"}if(window.s&&window.s.tl){s.un=au;s.linkTrackVars="events,eVar26,prop44,eVar62,prop57,eVar59";s.eVar26="Mbox Success";if(at){ar=at}else{ar=aw.substring(aw.indexOf("s.prop44=mboxCurrent.getName()+")+31,aw.indexOf("s.prop57")-1).replace(new RegExp("[+ ]","g"),"").replace(new RegExp("'","g"),"");ar=/[^a-z0-9* _:-]/ig.test(ar)?":::":ar}if((ao&&ar!==":::")||!ao){s.prop44=s.eVar62=ap+ar;s.prop57=ap;s.linkTrackEvents="event22";s.events="event22";s.eVar59=(aq&&aq.value.length>25)?aq.value:"NoTrackerId";s.tl("TnT","o","TnT");s.eVar26="";s.prop44="";s.eVar62="";s.prop57="";s.events="";s.eVar59=""}}}function N(aq,ap){if(aq&&!H[aq]){var ao=$(ap),ar=ao.data("parameter");H[aq]=true;if(ar){if(ar.DefaultContentControlClientId){ao.html("");if(ar.CQDriven){$("#"+ar.DefaultContentControlClientId).css("visibility","visible")}else{$("#"+ar.DefaultContentControlClientId).show();if(ar.DefaultContentControlClientId==="testAndTargetWhatsHot"&&$(".WhatsHotQuickLinksPanel").hasClass("HideRHSPanelExperiment")){fadeInRhsContent()}}}else{ao.html(ar.DefaultHtmlContent)}}}$(document).trigger("mbox_error",aq)}function u(ao){return H[ao]}function ai(ao){tntDefaultTimeout=ao}var c={getAudienceManagerProfileAsync:function(){var ap=0;if(typeof $.cbaMbox.campaignV1==="number"){ap=$.cbaMbox.campaignV1}addParameterToGlobalMboxRequest("campaignV1",ap);var aq=(typeof s!=="undefined"&&s.products&&s.products!=="")?s.products:$("#SC_PRODUCT_ID").val();if(aq&&aq!==""){addParameterToGlobalMboxRequest("Products",aq.replace(";",""))}var ao=Q.defer();E(b,function(){ao.resolve()});return ao.promise},loadTestAndTargetMBox:function(aq,ao,at){var ap=Q.defer();am[ao]=ap;setTimeout(function(){N(ao,h[aq])},j);var ar=Object.assign({},mboxRequestParameters);if(at){for(key in at){ar[key]=at[key]}}v(ao,aq,ar,h[ao])},loadWebContentMBox:function(ao,ap){return n(null,ap,"",ao).then(function(aq){if(!H[ao.data("parameter").Campaign]){ao.html(aq);O(ao.data("parameter").Campaign,ao)}})}};function F(ap,ao){if(typeof Logger!=="undefined"&&Logger&&Logger.initialised){Logger.log(ap,ao)}}function t(){var ao=[];if(mboxRequestParameters.CampaignAM){ao.push({CampaignAM:mboxRequestParameters.CampaignAM})}if(mboxRequestParameters.CampaignFC){ao.push({CampaignFC:mboxRequestParameters.CampaignFC})}if(mboxRequestParameters.CampaignOL){ao.push({CampaignOL:mboxRequestParameters.CampaignOL})}return ao}function X(ap,ao){var aq=ap.data("parameter");e(null,null,aq.FeedbackParams,"2",aq.Campaign,ao)}function x(ao){var ar=window.location.href;ao=ao.replace(/[\[\]]/g,"\\$&");var ap=new RegExp("[?&]"+ao+"(=([^&#]*)|&|#|$)","i"),aq=ap.exec(ar);if(!aq){return null}if(!aq[2]){return""}return decodeURIComponent(aq[2].replace(/\+/g," "))}function E(ar,ap){var aq=document.createElement("script");aq.type="text/javascript";aq.src=ar;aq.onload=ap;try{aq.onerror=ap}catch(ao){}aq.onreadystatechange=function(){if(this.readyState==="complete"||this.readyState==="loaded"){if(typeof ap==="function"){ap()}}};document.getElementsByTagName("head")[0].appendChild(aq);return aq}function Y(ao){b=ao}function Z(aq){var ao=document.getElementById("SC_WEBTRACKER_ID").value,ap=ao.length>25&&ao!="NoTrackerId"?ao:"";b=aq+ap}function w(){var ao=document.getElementById("SC_PAGE_NAME");var ap=ao?ao.value:"";return{name:"PageName",value:ap}}function d(at,ap){var ao=t();var aq=w();if(ao){ao.push(aq)}else{ao=[aq]}var ar={WebTrackerId:$.cbaMbox.trackerId,LocationId:ap,QueryPropositionId:x("PropositionId"),QueryLocation:x("LocationId"),AmSegments:ao};return Q($.ajax({type:"POST",url:at,data:JSON.stringify(ar),contentType:"application/json",dataType:"json",timeout:j,})).then(function(av){if(!av||av.Status!=="OK"||!av.Propositions||av.Propositions.length<1){F("cep_loadHelixScript",{multiplePropositionCode:true,method:"POST",status:"No data returned for propositions from service.",errorMessage:"Unable to get propositions for mboxes."});$.each(g,function(ay,ax){var aw=h[ax].data("parameter");if(!P[aw.Campaign]){c.loadTestAndTargetMBox(aw.MboxHolderId,aw.Campaign)}});return}var au=av.Propositions.map(function(aw){return aw.Location});$.each(av.Propositions,function(aw,ax){var ay=h[ax.Location];if(ay){ay.data("propositionList").push(ax)}});$.each(h,function(ax,aw){var az=aw.data("propositionList");var ay=P[ax];if(ay&&typeof ay==="function"){var aA=$.grep(az,function(aB){return aB.Location===ax});ay(aA,aw);O(ax,aw)}else{if(az.length===0){console.warn("cee box "+ax+" does not have proposition returned, use TNT as fallback");F("cep_loadHelixScript",{multiplePropositionCode:true,method:"POST",status:"Proposition mismatch with the location: "+ax,errorMessage:"Proposition locations is not present in mboxlocation config: "+ax});c.loadTestAndTargetMBox(aw.data("parameter").MboxHolderId,aw.data("parameter").Campaign)}else{z(az[0],aw)}}})},function(au){F("cep_loadHelixScript",{multiplePropositionCode:true,method:"POST",status:au.status,errorMessage:"Unable to get proposition codes for mboxes"});$.each(g,function(ax,aw){var av=h[aw].data("parameter");if(!P[av.Campaign]){c.loadTestAndTargetMBox(av.MboxHolderId,av.Campaign)}})})}function z(at,aq){var ao={propositionId:at.PropositionId,propositionToken:at.PropositionToken,actions:$.map(at.Actions,function(aw){return{Type:aw.Type,ActionToken:aw.ActionToken}})};aq.data("parameter").FeedbackParams=ao;if(aq.data("parameter").IsValidLocation&&at.Asset.Reference){if(at.Collateral&&at.Collateral.CollateralParams&&at.Collateral.CollateralParams.length>0){i[at.Location]=at.Collateral.CollateralParams}if(at.Asset.Reference.startsWith("tnt:")){var av=["ceePropId="+at.PropositionId,"ceeParams="+at.Asset.Reference.substr(at.Asset.Reference.indexOf(":")+1)];c.loadTestAndTargetMBox(aq.data("parameter").MboxHolderId,aq.data("parameter").Campaign,av)}else{var ar=at.PropositionId.replace(/\//g,"-"),au=at.Asset.Reference.replace(/\//g,"-");aq.data("parameter").TrackParams=":"+ar.substr(1,ar.length)+":CEE:"+au.substr(1,au.indexOf("-_jcr")-1);n(null,at.Asset.Reference,"",aq).then(function(aw){if(!H[aq.data("parameter").Campaign]){aq.html(aw);O(aq.data("parameter").Campaign,aq);y(aq);$(document).trigger("mbox_cee_banner_rendered")}})}var ap=$.grep(at.Actions,function(aw){return aw.Type==="ImpressionType"});if(ap&&ap.length>0){X(aq,ap[0])}}}function V(ap,ao){$.each(ao,function(aq,ar){var at=new RegExp("{"+ar.Key.toString()+"}","g");ap=ap.replace(at,ar.Value.toString());at=new RegExp("%7B"+ar.Key.toString()+"%7D","g");ap=ap.replace(at,ar.Value.toString())});return ap}function aa(ao){f=ao}function af(ao){q=S(ao)}function ad(ao){o=S(ao)}function B(ao){C=ao}function ac(ao){k=ao}function ab(ao){j=ao}function ae(ao){p=ao}function S(ao){return ao&&ao.substr(-1)==="/"?ao.slice(0,-1):ao}function D(ap){var aq=document.createElement("script");aq.type="text/javascript";aq.src=b;aq.onload=ap;try{aq.onerror=ap}catch(ao){}aq.onreadystatechange=function(){if(this.readyState==="complete"||this.readyState==="loaded"){if(typeof ap==="function"){ap()}}};document.body.appendChild(aq);return aq}function M(at,aq,au,ar){var ap=ar?"ttDivSecond":"ttDiv";var av=ar?"secondTimer":"timer";var ao=ar?al:ak;var aw=ar?"tntSelectedSecondaryVariant":"tntSelectedVariant";$('<div id="'+ap+'" data-parameter={"Campaign":"'+at+'"} style="display: none"></div>').appendTo("body");window[av]=setTimeout(function(){ao(window[aw])},au||4000);v(at,ap,mboxRequestParameters,$("#"+ap))}function L(ap,at,ar){var aq=document.getElementById("SC_WEBTRACKER_ID"),ao=function(){M(ap,true,at);if(ar){M(ar,true,at,true)}};if(aq&&aq.value.length>25){if(b.indexOf(aq.value)<1){b+=aq.value}D(ao)}else{ao()}}function A(ao){$("div.marketing_box_placeholder",ao).each(function(ar,aq){var au=$(this),av=au.data("parameter"),ax=av.TNTTimeout,aw=av.MboxHolderId,ap=av.Campaign,at=av.IsValidLocation;if(!a){a=c.getAudienceManagerProfileAsync()}m[ap]=av.CMXPath;if(!l[ap]&&at){g.push(ap);h[ap]=au;l[ap]=true;h[ap].data("propositionList",[])}a.then(function(){if(ap&&aw&&!at){if($("#"+aw).length>0){am[ap]=setTimeout(function(){N(ap,au)},ax);try{var ay=0;if(typeof $.cbaMbox.campaignV1==="number"){ay=$.cbaMbox.campaignV1}addParameterToGlobalMboxRequest("campaignV1",ay);var aA=(s&&s.products&&s.products!=="")?s.products:$("#SC_PRODUCT_ID").val();if(aA&&aA!==""){addParameterToGlobalMboxRequest("Products",aA.replace(";",""))}v(ap,aw,mboxRequestParameters,au)}catch(az){}}}},function(){F("marketing_audiencemanager",{errorMessage:"Failed to get AudienceManager segment data"})})});if(g.length>0){a.then(function(){d(k,g)})}}function v(ao,aq,ar,ap){adobe.target.getOffer({mbox:ao,params:ar,success:function(at){n(null,at[0].content,"",ap).then(function(av){if(!H[ao]){var au=document.getElementById(aq);if(au){au.innerHTML=av.innerHTML}O(ao,ap)}})},error:function(at){N(ao,$("#"+aq))}})}function I(){if(arguments&&arguments.length>0){var ao=arguments[0];var ap=Object.assign({},mboxRequestParameters);for(var at=1;at<arguments.length;at++){var ar=arguments[at].split("=");if(ar.length>0){ap[ar[0]]=ar[1]}}var aq=$("#"+ao);if(!aq.length||!aq.data("parameter")||!aq.data("parameter").Campaign){aq=$('<div id="'+ao+'" data-parameter={"Campaign":"'+ao+'"} style="display: none"></div>')}v(ao,ao,ap,aq)}}function K(){}function J(){if(arguments&&arguments.length>0){var at=arguments[0];var ap=Object.assign({},mboxRequestParameters);var ao=at;if(arguments.length>1){ao=arguments[1];for(var au=2;au<arguments.length;au++){var ar=arguments[au].split("=");if(ar.length>0){ap[ar[0]]=ar[1]}}}var aq=$("#"+at);if(!aq.length||!aq.data("parameter")||!aq.data("parameter").Campaign){aq=$('<div id="'+at+'" data-parameter={"Campaign":"'+ao+'"} style="display: none"></div>')}v(ao,at,ap,aq)}}function U(ar){var ap=/\/content.*campaigns.*nb-tnt.*_jcr_content.*par.html/g,aq=ar.match(ap);if(aq){return Q($.ajax({type:"GET",url:T+(T.indexOf("?")<0?"?":"&")+"TemplateKey="+encodeURIComponent(aq[0]),}).fail(function(at){}))}var ao=Q.defer();ao.resolve("");return ao.promise}function y(aq){var at=aq.data("propositionList"),ao=aq.data("parameter").FeedbackParams.propositionId,ar=aq.data("parameter").MboxHolderId,ap=at.map(function(au){return au.PropositionId}).indexOf(ao);if(at[ap+1]){aq.find("a, button:not([data-no-action])").on("click",function(){H[ar]=false;z(at[ap+1],aq)})}else{if(location.pathname.indexOf("dynamiclandingpage")===-1){aq.find("a, button:not([data-no-action])").on("click",function(){aq.hide()})}}}function ag(ao,ap){return H[ao]=ap}function ah(ao){T=ao}function ak(ao){clearTimeout(this.timer);window.tntSelectedVariant=ao;$(document).trigger("tntCallback_success",ao)}function al(ao){clearTimeout(this.secondTimer);window.tntSelectedSecondaryVariant=ao;$(document).trigger("tntSecondaryCallback_success",ao)}function e(aw,aq,at,ap,au,ar){ap=ap||"1";var ao=ar||r(at,ap);var av={WebTrackerId:$.cbaMbox.trackerId,Location:au,PropositionToken:at.propositionToken,ActionType:ao?ao.Type:"",ActionToken:ao?ao.ActionToken:""};return Q($.ajax({type:"POST",url:f,contentType:"application/json",processData:false,data:JSON.stringify(av),dataType:"json",timeout:$.cbaMbox.feedBackUrlTimeout})).fail(function(ax){F("cep_feedback_failure",{location:av.Location,propositionId:at.propositionId,actionType:av.Action.Type,errorMessage:"Unable to send user feedback for proposals"})}).fin(function(){if(aq&&aq!=="#"){if(aw){window.open(aq)}else{window.location.href=aq}}})}function r(aq,ao){var ap;switch(ao){case"1":ap="ApplyNowActionType";break;case"0":ap="NANowActionType";break;case"-1":ap="RejectActionType";break;case"2":ap="ImpressionType";break;case"3":ap="RemindType";break;case"4":ap="FulfilmentType";break;default:ap=ao;break}var ar=$.grep(aq.actions,function(at){return at.Type===ap});if(ar.length>0){return ar[0]}}function R(ap,ao){P[ap]=ao}$.cbaMbox=$.extend({},$.cbaMbox,{setAMUrl:Y,setCeeUrl:ac,setCeeFeedBackUrl:aa,setRenderHtmlUrl:ah,isCEPNetBankPilot:B,onSuccess:O,onError:N,createDiv:n,ceeCallOnBanner:e,getMboxContentShown:u,setMboxContentShown:ag,setCeeTimeOut:ab,setFeedBackUrlTimeout:ae,setAMUrlViaHiddenInput:Z,setFolBaseUrl:af,setDpBaseUrl:ad,registerPropositionHandler:R,trackMboxImpression:an});if(!window.CommBank){window.CommBank={}}if(!CommBank.Online){CommBank.Online={}}if(!CommBank.Online.Common){CommBank.Online.Common={}}CommBank.Online.Common.TestAndTarget={myAMmBox:L,mymbox:M,initMbox:A,tntCallback:ak,tntSecondaryCallback:al,mboxCreate:I,mboxDefine:J,mboxUpdate:K}}());var initMbox=CommBank.Online.Common.TestAndTarget.initMbox;var tntCallback=CommBank.Online.Common.TestAndTarget.tntCallback;var tntSecondaryCallback=CommBank.Online.Common.TestAndTarget.tntSecondaryCallback;var mboxCreate=CommBank.Online.Common.TestAndTarget.mboxCreate;var mboxDefine=CommBank.Online.Common.TestAndTarget.mboxDefine;var mboxUpdate=CommBank.Online.Common.TestAndTarget.mboxUpdate;
/*
 *
 * Copyright 2009-2012 Kris Kowal under the terms of the MIT
 * license found at http://github.com/kriskowal/q/raw/master/LICENSE
 *
 * With parts by Tyler Close
 * Copyright 2007-2009 Tyler Close under the terms of the MIT X license found
 * at http://www.opensource.org/licenses/mit-license.html
 * Forked at ref_send.js version: 2009-05-11
 *
 * With parts by Mark Miller
 * Copyright (C) 2011 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */
(function(a){if(typeof bootstrap==="function"){bootstrap("promise",a)}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=a()}else{if(typeof define==="function"&&define.amd){define(a)}else{if(typeof ses!=="undefined"){if(!ses.ok()){return}else{ses.makeQ=a}}else{if(typeof window!=="undefined"||typeof self!=="undefined"){var b=typeof window!=="undefined"?window:self;var c=b.Q;b.Q=a();b.Q.noConflict=function(){b.Q=c;return this}}else{throw new Error("This environment was not anticipated by Q. Please file a bug.")}}}}}})(function(){var w=false;try{throw new Error()}catch(r){w=!!r.stack}var Z=m();var X;var L=function(){};var J=(function(){var aq={task:void 0,next:null};var ax=aq;var ap=false;var av=void 0;var ar=false;var at=[];function ao(){var az,ay;while(aq.next){aq=aq.next;az=aq.task;aq.task=void 0;ay=aq.domain;if(ay){aq.domain=void 0;ay.enter()}aw(az,ay)}while(at.length){az=at.pop();aw(az)}ap=false}function aw(aA,ay){try{aA()}catch(az){if(ar){if(ay){ay.exit()}setTimeout(ao,0);if(ay){ay.enter()}throw az}else{setTimeout(function(){throw az},0)}}if(ay){ay.exit()}}J=function(ay){ax=ax.next={task:ay,domain:ar&&process.domain,next:null};if(!ap){ap=true;av()}};if(typeof process==="object"&&process.toString()==="[object process]"&&process.nextTick){ar=true;av=function(){process.nextTick(ao)}}else{if(typeof setImmediate==="function"){if(typeof window!=="undefined"){av=setImmediate.bind(window,ao)}else{av=function(){setImmediate(ao)}}}else{if(typeof MessageChannel!=="undefined"){var e=new MessageChannel();e.port1.onmessage=function(){av=au;e.port1.onmessage=ao;ao()};var au=function(){e.port2.postMessage(0)};av=function(){setTimeout(ao,0);au()}}else{av=function(){setTimeout(ao,0)}}}}J.runAfter=function(ay){at.push(ay);if(!ap){ap=true;av()}};return J})();var l=Function.call;function aj(e){return function(){return l.apply(e,arguments)}}var j=aj(Array.prototype.slice);var i=aj(Array.prototype.reduce||function(ao,e){var ap=0,aq=this.length;if(arguments.length===1){do{if(ap in this){e=this[ap++];break}if(++ap>=aq){throw new TypeError()}}while(1)}for(;ap<aq;ap++){if(ap in this){e=ao(e,this[ap],ap)}}return e});var g=aj(Array.prototype.indexOf||function(ao){for(var e=0;e<this.length;e++){if(this[e]===ao){return e}}return -1});var h=aj(Array.prototype.map||function(e,aq){var ap=this;var ao=[];i(ap,function(at,au,ar){ao.push(e.call(aq,au,ar,ap))},void 0);return ao});var M=Object.create||function(e){function ao(){}ao.prototype=e;return new ao()};var N=aj(Object.prototype.hasOwnProperty);var O=Object.keys||function(ap){var ao=[];for(var e in ap){if(N(ap,e)){ao.push(e)}}return ao};var P=aj(Object.prototype.toString);function A(e){return e===Object(e)}function F(e){return(P(e)==="[object StopIteration]"||e instanceof Y)}var Y;if(typeof ReturnValue!=="undefined"){Y=ReturnValue}else{Y=function(e){this.value=e}}var ag="From previous event:";function G(ao,aq){if(w&&aq.stack&&typeof ao==="object"&&ao!==null&&ao.stack&&ao.stack.indexOf(ag)===-1){var ar=[];for(var ap=aq;!!ap;ap=ap.source){if(ap.stack){ar.unshift(ap.stack)}}ar.unshift(ao.stack);var e=ar.join("\n"+ag+"\n");ao.stack=t(e)}}function t(ar){var aq=ar.split("\n");var e=[];for(var ao=0;ao<aq.length;++ao){var ap=aq[ao];if(!y(ap)&&!z(ap)&&ap){e.push(ap)}}return e.join("\n")}function z(e){return e.indexOf("(module.js:")!==-1||e.indexOf("(node.js:")!==-1}function v(aq){var e=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(aq);if(e){return[e[1],Number(e[2])]}var ao=/at ([^ ]+):(\d+):(?:\d+)$/.exec(aq);if(ao){return[ao[1],Number(ao[2])]}var ap=/.*@(.+):(\d+)$/.exec(aq);if(ap){return[ap[1],Number(ap[2])]}}function y(aq){var ao=v(aq);if(!ao){return false}var e=ao[0];var ap=ao[1];return e===X&&ap>=Z&&ap<=W}function m(){if(!w){return}try{throw new Error()}catch(ao){var ar=ao.stack.split("\n");var aq=ar[0].indexOf("@")>0?ar[1]:ar[2];var ap=v(aq);if(!ap){return}X=ap[0];return ap[1]}}function p(ao,ap,e){return function(){if(typeof console!=="undefined"&&typeof console.warn==="function"){console.warn(ap+" is deprecated, use "+e+" instead.",new Error("").stack)}return ao.apply(ao,arguments)}}function V(e){if(e instanceof T){return e}if(D(e)){return n(e)}else{return u(e)}}V.resolve=V;V.nextTick=J;V.longStackSupport=false;if(typeof process==="object"&&process&&process.env&&process.env.Q_DEBUG){V.longStackSupport=true}V.defer=o;function o(){var ar=[],at=[],av;var ap=M(o.prototype);var au=M(T.prototype);au.promiseDispatch=function(ay,aw,ax){var e=j(arguments);if(ar){ar.push(e);if(aw==="when"&&ax[1]){at.push(ax[1])}}else{V.nextTick(function(){av.promiseDispatch.apply(av,e)})}};au.valueOf=function(){if(ar){return au}var e=I(av);if(C(e)){av=e}return e};au.inspect=function(){if(!av){return{state:"pending"}}return av.inspect()};if(V.longStackSupport&&w){try{throw new Error()}catch(aq){au.stack=aq.stack.substring(aq.stack.indexOf("\n")+1)}}function ao(e){av=e;au.source=e;i(ar,function(ax,aw){V.nextTick(function(){e.promiseDispatch.apply(e,aw)})},void 0);ar=void 0;at=void 0}ap.promise=au;ap.resolve=function(e){if(av){return}ao(V(e))};ap.fulfill=function(e){if(av){return}ao(u(e))};ap.reject=function(e){if(av){return}ao(ab(e))};ap.notify=function(e){if(av){return}i(at,function(ax,aw){V.nextTick(function(){aw(e)})},void 0)};return ap}o.prototype.makeNodeResolver=function(){var e=this;return function(ao,ap){if(ao){e.reject(ao)}else{if(arguments.length>2){e.resolve(j(arguments,1))}else{e.resolve(ap)}}}};V.Promise=S;V.promise=S;function S(ap){if(typeof ap!=="function"){throw new TypeError("resolver must be a function.")}var e=o();try{ap(e.resolve,e.reject,e.notify)}catch(ao){e.reject(ao)}return e.promise}S.race=aa;S.all=b;S.reject=ab;S.resolve=V;V.passByCopy=function(e){return e};T.prototype.passByCopy=function(){return this};V.join=function(e,ao){return V(e).join(ao)};T.prototype.join=function(e){return V([this,e]).spread(function(ao,ap){if(ao===ap){return ao}else{throw new Error("Can't join: not the same: "+ao+" "+ap)}})};V.race=aa;function aa(e){return S(function(ar,aq){for(var ao=0,ap=e.length;ao<ap;ao++){V(e[ao]).then(ar,aq)}})}T.prototype.race=function(){return this.then(V.race)};V.makePromise=T;function T(e,ao,ap){if(ao===void 0){ao=function(at){return ab(new Error("Promise does not support operation: "+at))}}if(ap===void 0){ap=function(){return{state:"unknown"}}}var ar=M(T.prototype);ar.promiseDispatch=function(aw,av,at){var ax;try{if(e[av]){ax=e[av].apply(ar,at)}else{ax=ao.call(ar,av,at)}}catch(au){ax=ab(au)}if(aw){aw(ax)}};ar.inspect=ap;if(ap){var aq=ap();if(aq.state==="rejected"){ar.exception=aq.reason}ar.valueOf=function(){var at=ap();if(at.state==="pending"||at.state==="rejected"){return ar}return at.value}}return ar}T.prototype.toString=function(){return"[object Promise]"};T.prototype.then=function(at,av,au){var aw=this;var aq=o();var ar=false;function e(ay){try{return typeof at==="function"?at(ay):ay}catch(ax){return ab(ax)}}function ap(ax){if(typeof av==="function"){G(ax,aw);try{return av(ax)}catch(ay){return ab(ay)}}return ab(ax)}function ao(ax){return typeof au==="function"?au(ax):ax}V.nextTick(function(){aw.promiseDispatch(function(ax){if(ar){return}ar=true;aq.resolve(e(ax))},"when",[function(ax){if(ar){return}ar=true;aq.resolve(ap(ax))}])});aw.promiseDispatch(void 0,"when",[void 0,function(aA){var ay;var az=false;try{ay=ao(aA)}catch(ax){az=true;if(V.onerror){V.onerror(ax)}else{throw ax}}if(!az){aq.notify(ay)}}]);return aq.promise};V.tap=function(ao,e){return V(ao).tap(e)};T.prototype.tap=function(e){e=V(e);return this.then(function(ao){return e.fcall(ao).thenResolve(ao)})};V.when=an;function an(aq,e,ap,ao){return V(aq).then(e,ap,ao)}T.prototype.thenResolve=function(e){return this.then(function(){return e})};V.thenResolve=function(e,ao){return V(e).thenResolve(ao)};T.prototype.thenReject=function(e){return this.then(function(){throw e})};V.thenReject=function(e,ao){return V(e).thenReject(ao)};V.nearer=I;function I(ao){if(C(ao)){var e=ao.inspect();if(e.state==="fulfilled"){return e.value}}return ao}V.isPromise=C;function C(e){return e instanceof T}V.isPromiseAlike=D;function D(e){return A(e)&&typeof e.then==="function"}V.isPending=B;function B(e){return C(e)&&e.inspect().state==="pending"}T.prototype.isPending=function(){return this.inspect().state==="pending"};V.isFulfilled=x;function x(e){return !C(e)||e.inspect().state==="fulfilled"}T.prototype.isFulfilled=function(){return this.inspect().state==="fulfilled"};V.isRejected=E;function E(e){return C(e)&&e.inspect().state==="rejected"}T.prototype.isRejected=function(){return this.inspect().state==="rejected"};var ak=[];var al=[];var ac=[];var ai=true;function ad(){ak.length=0;al.length=0;if(!ai){ai=true}}function ah(e,ao){if(!ai){return}if(typeof process==="object"&&typeof process.emit==="function"){V.nextTick.runAfter(function(){if(g(al,e)!==-1){process.emit("unhandledRejection",ao,e);ac.push(e)}})}al.push(e);if(ao&&typeof ao.stack!=="undefined"){ak.push(ao.stack)}else{ak.push("(no stack) "+ao)}}function am(ao){if(!ai){return}var e=g(al,ao);if(e!==-1){if(typeof process==="object"&&typeof process.emit==="function"){V.nextTick.runAfter(function(){var ap=g(ac,ao);if(ap!==-1){process.emit("rejectionHandled",ak[e],ao);ac.splice(ap,1)}})}al.splice(e,1);ak.splice(e,1)}}V.resetUnhandledRejections=ad;V.getUnhandledReasons=function(){return ak.slice()};V.stopUnhandledRejectionTracking=function(){ad();ai=false};ad();V.reject=ab;function ab(ap){var aq=T({when:function(ar){if(ar){am(this)}return ar?ar(ap):this}},function e(){return this},function ao(){return{state:"rejected",reason:ap}});ah(aq,ap);return aq}V.fulfill=u;function u(ao){return T({when:function(){return ao},get:function(ap){return ao[ap]},set:function(ap,aq){ao[ap]=aq},"delete":function(ap){delete ao[ap]},post:function(aq,ap){if(aq===null||aq===void 0){return ao.apply(void 0,ap)}else{return ao[aq].apply(ao,ap)}},apply:function(aq,ap){return ao.apply(aq,ap)},keys:function(){return O(ao)}},void 0,function e(){return{state:"fulfilled",value:ao}})}function n(ao){var e=o();V.nextTick(function(){try{ao.then(e.resolve,e.reject,e.notify)}catch(ap){e.reject(ap)}});return e.promise}V.master=H;function H(ao){return T({isDef:function(){}},function e(aq,ap){return q(ao,aq,ap)},function(){return V(ao).inspect()})}V.spread=af;function af(ap,e,ao){return V(ap).spread(e,ao)}T.prototype.spread=function(e,ao){return this.all().then(function(ap){return e.apply(void 0,ap)},ao)};V.async=k;function k(e){return function(){function ap(aw,at){var av;if(typeof StopIteration==="undefined"){try{av=ar[aw](at)}catch(au){return ab(au)}if(av.done){return V(av.value)}else{return an(av.value,ao,aq)}}else{try{av=ar[aw](at)}catch(au){if(F(au)){return V(au.value)}else{return ab(au)}}return an(av,ao,aq)}}var ar=e.apply(this,arguments);var ao=ap.bind(ap,"next");var aq=ap.bind(ap,"throw");return ao()}}V.spawn=ae;function ae(e){V.done(V.async(e)())}V["return"]=a;function a(e){throw new Y(e)}V.promised=U;function U(e){return function(){return af([this,b(arguments)],function(ap,ao){return e.apply(ap,ao)})}}V.dispatch=q;function q(ao,ap,e){return V(ao).dispatch(ap,e)}T.prototype.dispatch=function(ap,e){var aq=this;var ao=o();V.nextTick(function(){aq.promiseDispatch(ao.resolve,ap,e)});return ao.promise};V.get=function(ao,e){return V(ao).dispatch("get",[e])};T.prototype.get=function(e){return this.dispatch("get",[e])};V.set=function(ao,e,ap){return V(ao).dispatch("set",[e,ap])};T.prototype.set=function(e,ao){return this.dispatch("set",[e,ao])};V.del=V["delete"]=function(ao,e){return V(ao).dispatch("delete",[e])};T.prototype.del=T.prototype["delete"]=function(e){return this.dispatch("delete",[e])};V.mapply=V.post=function(ap,ao,e){return V(ap).dispatch("post",[ao,e])};T.prototype.mapply=T.prototype.post=function(ao,e){return this.dispatch("post",[ao,e])};V.send=V.mcall=V.invoke=function(ao,e){return V(ao).dispatch("post",[e,j(arguments,2)])};T.prototype.send=T.prototype.mcall=T.prototype.invoke=function(e){return this.dispatch("post",[e,j(arguments,1)])};V.fapply=function(ao,e){return V(ao).dispatch("apply",[void 0,e])};T.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])};V["try"]=V.fcall=function(e){return V(e).dispatch("apply",[void 0,j(arguments,1)])};T.prototype.fcall=function(){return this.dispatch("apply",[void 0,j(arguments)])};V.fbind=function(ap){var aq=V(ap);var e=j(arguments,1);return function ao(){return aq.dispatch("apply",[this,e.concat(j(arguments))])}};T.prototype.fbind=function(){var ap=this;var e=j(arguments);return function ao(){return ap.dispatch("apply",[this,e.concat(j(arguments))])}};V.keys=function(e){return V(e).dispatch("keys",[])};T.prototype.keys=function(){return this.dispatch("keys",[])};V.all=b;function b(e){return an(e,function(aq){var ap=0;var ao=o();i(aq,function(av,at,ar){var au;if(C(at)&&(au=at.inspect()).state==="fulfilled"){aq[ar]=au.value}else{++ap;an(at,function(aw){aq[ar]=aw;if(--ap===0){ao.resolve(aq)}},ao.reject,function(aw){ao.notify({index:ar,value:aw})})}},void 0);if(ap===0){ao.resolve(aq)}return ao.promise})}T.prototype.all=function(){return b(this)};V.any=f;function f(ap){if(ap.length===0){return V.resolve()}var e=V.defer();var ao=0;i(ap,function(aw,aq,ar){var ax=ap[ar];ao++;an(ax,at,av,au);function at(ay){e.resolve(ay)}function av(){ao--;if(ao===0){e.reject(new Error("Can't get fulfillment value from any promise, all promises were rejected."))}}function au(ay){e.notify({index:ar,value:ay})}},undefined);return e.promise}T.prototype.any=function(){return f(this)};V.allResolved=p(c,"allResolved","allSettled");function c(e){return an(e,function(ao){ao=h(ao,V);return an(b(h(ao,function(ap){return an(ap,L,L)})),function(){return ao})})}T.prototype.allResolved=function(){return c(this)};V.allSettled=d;function d(e){return V(e).allSettled()}T.prototype.allSettled=function(){return this.then(function(e){return b(h(e,function(ao){ao=V(ao);function ap(){return ao.inspect()}return ao.then(ap,ap)}))})};V.fail=V["catch"]=function(e,ao){return V(e).then(void 0,ao)};T.prototype.fail=T.prototype["catch"]=function(e){return this.then(void 0,e)};V.progress=R;function R(e,ao){return V(e).then(void 0,void 0,ao)}T.prototype.progress=function(e){return this.then(void 0,void 0,e)};V.fin=V["finally"]=function(ao,e){return V(ao)["finally"](e)};T.prototype.fin=T.prototype["finally"]=function(e){if(!e||typeof e.apply!=="function"){throw new Error("Can't apply finally callback")}e=V(e);return this.then(function(ao){return e.fcall().then(function(){return ao})},function(ao){return e.fcall().then(function(){throw ao})})};V.done=function(ao,e,aq,ap){return V(ao).done(e,aq,ap)};T.prototype.done=function(e,ar,ap){var ao=function(at){V.nextTick(function(){G(at,aq);if(V.onerror){V.onerror(at)}else{throw at}})};var aq=e||ar||ap?this.then(e,ar,ap):this;if(typeof process==="object"&&process&&process.domain){ao=process.domain.bind(ao)}aq.then(void 0,ao)};V.timeout=function(ap,ao,e){return V(ap).timeout(ao,e)};T.prototype.timeout=function(ap,ao){var e=o();var aq=setTimeout(function(){if(!ao||"string"===typeof ao){ao=new Error(ao||"Timed out after "+ap+" ms");ao.code="ETIMEDOUT"}e.reject(ao)},ap);this.then(function(ar){clearTimeout(aq);e.resolve(ar)},function(ar){clearTimeout(aq);e.reject(ar)},e.notify);return e.promise};V.delay=function(e,ao){if(ao===void 0){ao=e;e=void 0}return V(e).delay(ao)};T.prototype.delay=function(e){return this.then(function(ap){var ao=o();setTimeout(function(){ao.resolve(ap)},e);return ao.promise})};V.nfapply=function(ao,e){return V(ao).nfapply(e)};T.prototype.nfapply=function(e){var ao=o();var ap=j(e);ap.push(ao.makeNodeResolver());this.fapply(ap).fail(ao.reject);return ao.promise};V.nfcall=function(ao){var e=j(arguments,1);return V(ao).nfapply(e)};T.prototype.nfcall=function(){var ao=j(arguments);var e=o();ao.push(e.makeNodeResolver());this.fapply(ao).fail(e.reject);return e.promise};V.nfbind=V.denodeify=function(ao){var e=j(arguments,1);return function(){var aq=e.concat(j(arguments));var ap=o();aq.push(ap.makeNodeResolver());V(ao).fapply(aq).fail(ap.reject);return ap.promise}};T.prototype.nfbind=T.prototype.denodeify=function(){var e=j(arguments);e.unshift(this);return V.denodeify.apply(void 0,e)};V.nbind=function(ao,ap){var e=j(arguments,2);return function(){var at=e.concat(j(arguments));var ar=o();at.push(ar.makeNodeResolver());function aq(){return ao.apply(ap,arguments)}V(aq).fapply(at).fail(ar.reject);return ar.promise}};T.prototype.nbind=function(){var e=j(arguments,0);e.unshift(this);return V.nbind.apply(void 0,e)};V.nmapply=V.npost=function(ap,ao,e){return V(ap).npost(ao,e)};T.prototype.nmapply=T.prototype.npost=function(ap,e){var aq=j(e||[]);var ao=o();aq.push(ao.makeNodeResolver());this.dispatch("post",[ap,aq]).fail(ao.reject);return ao.promise};V.nsend=V.nmcall=V.ninvoke=function(aq,ao){var ap=j(arguments,2);var e=o();ap.push(e.makeNodeResolver());V(aq).dispatch("post",[ao,ap]).fail(e.reject);return e.promise};T.prototype.nsend=T.prototype.nmcall=T.prototype.ninvoke=function(ao){var ap=j(arguments,1);var e=o();ap.push(e.makeNodeResolver());this.dispatch("post",[ao,ap]).fail(e.reject);return e.promise};V.nodeify=K;function K(ao,e){return V(ao).nodeify(e)}T.prototype.nodeify=function(e){if(e){this.then(function(ao){V.nextTick(function(){e(null,ao)})},function(ao){V.nextTick(function(){e(ao)})})}else{return this}};V.noConflict=function(){throw new Error("Q.noConflict only works when Q is used as a global")};var W=m();return V});